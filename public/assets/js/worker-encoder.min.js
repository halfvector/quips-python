function initializeEncoder(e,t){g_EncoderState=Module._lexy_encoder_start(e,.3),g_BufferSamples=t,g_AudioBufferLeft=new Float32Array(Module.HEAPF32.buffer,Module._malloc(4*g_BufferSamples),g_BufferSamples),g_AudioBufferRight=new Float32Array(Module.HEAPF32.buffer,Module._malloc(4*g_BufferSamples),g_BufferSamples)}function shutdownEncoder(){Module._lexy_encoder_finish(g_EncoderState);var e=Module._lexy_get_buffer(g_EncoderState),t=Module._lexy_get_buffer_length(g_EncoderState),f=new Uint8Array(Module.HEAPU8.buffer,e,t);postMessage({action:"encoded",buffer:f}),self.close()}function getAverageVolume(e){for(var t,f=0,r=e.length,o=0;r>o;o++)f+=e[o];return t=f/r}postMessage({action:"started"});var g_AudioBufferLeft,g_AudioBufferRight,g_Initialized=!1,g_EncoderState,g_BufferSamples=4096;onmessage=function(e){if("initialize"==e.data.action&&initializeEncoder(e.data.sample_rate,e.data.buffer_size),"finish"==e.data.action&&shutdownEncoder(),"process"==e.data.action){for(var t=0;t<e.data.left.length;t++)g_AudioBufferLeft[t]=e.data.left[t],g_AudioBufferRight[t]=e.data.right[t];Module._lexy_encoder_write(g_EncoderState,g_AudioBufferLeft.byteOffset,g_AudioBufferRight.byteOffset,g_BufferSamples)}},importScripts("/assets/js/ogg-vorbis-encoder.js");